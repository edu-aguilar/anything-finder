<link rel="import" href="./bower_components/polymer/polymer-element.html">
<link rel="import" href="./swc-button.html">

<dom-module id="swc-input-submit">
  <template>
    <style>
      :host {
        display: block;
        width: 100%;
        height: 100%;
        @apply --swc-input-submit;
      }

      .input-submit-wrapper {
       display: flex;
       justify-content: center;
       height: 30px;
       @apply --swc-input-submit-wrapper;
     }

      swc-button {
       --swc-button: {
          display: block;
          width: 20%;
          height: 100%;
          cursor: not-allowed;
          --main-color: var(--swc-button-main-color, #ff1727);
          --disabled-color: var(--swc-button-disabled-color, #e9e9e9);
          --active-color: var(--swc-button-active-color, #ff8c94);
          @apply --swc-input-submit-swc-button;
       };

       --swc-button-button-default: {
         box-shadow:none;
         @apply --swc-input-submit-button-default;
       };
      
       --swc-button-button-disabled: {
         @apply --swc-input-submit-button-disabled;
       };

      --swc-button-button-hober: {
        cursor:pointer;
        @apply --swc-input-submit-button-hover;
      };
     }
 
     input {
       width: 80%;
       font-size: 12px;
       display: block;
       outline: none;
       @apply --swc-input-submit-input;
     }

      input:disabled {
        opacity: 0.6;
        pointer-events: none;
        @apply --swc-input-submit-input-disabled;
     }
    </style>

    <div class="input-submit-wrapper">
      <input
        disabled$="[[disabled]]"
        autofocus$="[[autoFocus]]"
        placeholder="[[placeholder]]"
        type="text"
        value="{{value::input}}">

      <swc-button
        event-name="onBtnClicked"
        label="[[buttonLabel]]">
      </swc-button>
    </div>
  </template>

  <script>
  /**
     * `swc-input-submit` is composed by a native html input and a swc-button
     * whose styles are based in the “Sopra Steria Web Components” family.
     *
     * The component has a functionality to enable the button when a regular expression is matched with the input value.
     * The component will be able to dispatch an event with introduced data.
     *
     * ### Styling
     * `swc-input-submit` provides the following custom properties and mixins for styling:
     *
     * Custom property                   | Description                                        | Default
     * ----------------------------------|----------------------------------------------------|------------------------------------------------
     * `--main-color`                    | Background color of the button with default state  | #ff1727
     * `--disabled-color`                | Background color of the button when is disabled    | #e9e9e9
     * `--active-color`                  | Background color of the button when is active      | #ff8c94
     *
     * Custom Mixin                          | Description                                                         | Default
     * --------------------------------------|---------------------------------------------------------------------|----------
     * `--swc-input-submit`                  | Mixin applies to the component itself.                              |`{}`
     * `--swc-input-submit-wrapper`          | Mixin applies to the container of input and button.                 |`{}`
     * `--swc-input-submit-swc-button`       | Mixin applies to the button component itself                        |`{}`
     * `--swc-input-submit-button-default`   | Mixin applies to the default button.                                |`{}`
     * `--swc-input-submit-button-disabled`  | Mixin applies to the button when is disabled.                       |`{}`
     * `--swc-input-submit-button-hover`     | Mixin applies to the button when is hover.                          |`{}`
     * `--swc-input-submit-input`            | Mixin applies to the input.                                         |`{}`
     * `--swc-input-submit-input-disabled`   | Mixin applies to the input when is disabled.                        |`{}`
     *
     * # Sopra Steria Web Component
     * @customElement
     * @polymer
     * @demo demo/index.html
     */
    class SwcInputSubmit extends (class extends Polymer.Element { }) {
      static get is() {
        return 'swc-input-submit';
      }

      static get properties() {
        return {
          /**
           * The value of the data introduced in the input.
           * @type {String}
           */
          value: {
            type: String,
            value: null
          },
          /**
           * The disabled property for the input.
           * @type {Boolean}
           */
          disabled: {
            type: Boolean,
            value: false
          },
          /**
           * Specifies a short hint that describes the expected value of the input.
           * @type {String}
           */
          placeholder: {
            type: String,
            value: ''
          },
          /**
           * Specifies that the input element should automatically get focus when the page loads.
           * @type {Boolean}
           */
          autoFocus: {
            type: Boolean,
            value: false
          },
          /**
           * The text to put in the button.
           * @type {String}
           */
          buttonLabel: {
            type: String,
            value: 'label'
          },
          /**
           * The regex to validate the input value.
           * @type {RegExp}
           */
          regExp: {
            type: RegExp,
            value: /[^\s\\]/
          },
          /**
           * The name of the event triggered when the button is clicked.
           * @type {String}
           */
          eventName: {
            type: String,
            value: 'default-input-submit-event'
          }
        };
      }

      static get observers() {
        return [
          '_checkRegex(value)'
        ];
      }

      /**
       * Use for one-time configuration of your component after local DOM is initialized.
       */
      ready() {
        super.ready();

        Polymer.RenderStatus.afterNextRender(null, () => {
          this.addEventListener('onBtnClicked', this._fireEvent);
        });
      }

      /**
       * Enables the button if the input value matches the regular expression.
       *
       * @param {String} newValue The last value in the input.
       */
      _checkRegex(newValue) {
        const validationExp = new RegExp(this.regExp);
        let btnElement = this.shadowRoot.querySelector('swc-button');
        btnElement.disabled = !validationExp.test(newValue) || !newValue;
      }

      /**
       * Fires an event giving the input value.
       *
       * @event eventName
       * @param {Object} event Default event from swc-button.
       */
      _fireEvent(event) {
        event.preventDefault();
        let buttonClickedEvent = new CustomEvent(this.eventName, {
          bubbles: true,
          composed: true,
          detail: { value: this.value }
        });
        this.dispatchEvent(buttonClickedEvent);
      }
    }

    window.customElements.define(SwcInputSubmit.is, SwcInputSubmit);
  </script>
</dom-module>